#!/usr/bin/env bash
set -euo pipefail

FILE=src/Queries.elm

function write_query_to_file() {
  NAME=$(echo "$1" | sed 's/.*\/\(.*\).graphql/\1/')
  echo "" >> "$FILE"
  echo "$NAME :: String" >> "$FILE"
  echo "$NAME =" >> "$FILE"
  echo '  """' >> "$FILE"
  cat "$1" >> "$FILE"
  echo '"""' >> "$FILE"
}


cat <<HEREDOC > "$FILE"
module Queries exposing (..)

-- This file is generated by bin/generate-queries-module.sh and
-- the src/Queries.elm Makefile goal.
--
-- Do not modify this file directly.
HEREDOC

for QUERY_FILE in queries/*.graphql
do
  write_query_to_file "$QUERY_FILE"
done

echo Regenerated "$FILE"
